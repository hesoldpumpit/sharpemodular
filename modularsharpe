import plotly.express as px
import pandas as pd
import numpy as np
import yfinance as yf

# if your portfolio has more than 3 different coins, use the lines with the '#' in front of it
# instead of or along with the line directly above it

def get_data(ticker):
    data = yf.Ticker(ticker + '-USD').history(period='max').reset_index()[['Date', 'Open']]
    data = data.rename(columns={'Open': ticker})
    data[ticker] = data[ticker] / data[ticker].iloc[0]
    return data



coin = ['BTC', 'LTC', 'ADA']
# coin = ['BTC', 'LTC', 'ADA', 'XMR']

df0 = get_data(coin[0])
df1 = get_data(coin[1])
df2 = get_data(coin[2])
# df3 = get_data(coin[3])
# if u got any other shitcoins they go here

df = pd.merge(df0, df1, on='Date', how='inner')
df = pd.merge(df, df2, on='Date', how='inner')
# df = pd.merge(df, df3, on='Date', how='inner')
# if u wanna merge any more keep repeating the line above this one like df = pd.merge(df, dfx, on='Date',how='inner')

df = df.set_index('Date')
df = df / df.iloc[0]

dfret = df.pct_change()
mean_returns = dfret.mean()
cov_matrix = dfret.cov()


num_iterations = 100000
simulation_res = np.zeros((4 + len(coin) - 1, num_iterations))
for i in range(num_iterations):
    weights = np.array(np.random.random(len(coin)))
    weights /= np.sum(weights)

    portfolio_return = np.sum(mean_returns * weights)
    portfolio_std_dev = np.sqrt(np.dot(weights.T, np.dot(cov_matrix, weights)))

    simulation_res[0, i] = portfolio_return
    simulation_res[1, i] = portfolio_std_dev
    simulation_res[2, i] = simulation_res[0, i] / simulation_res[1, i]
    for j in range(len(weights)):
        simulation_res[j + 3, i] = weights[j]

dfplot = pd.DataFrame(simulation_res.T, columns=['avg_ret', 'std', 'sharpe', coin[0], coin[1], coin[2]])
# dfplot = pd.DataFrame(simulation_res.T, columns=['avg_ret', 'std', 'sharpe', coin[0], coin[1], coin[2], coin[3], if u got any other shitcoins they go here])
dfplot['size'] = 5

fig = px.scatter(dfplot, x='std', y='avg_ret',
                 color='sharpe', template='plotly_dark', size='size',
                 hover_data=coin)
fig.update_xaxes(title_text='Volatility', title_font_size=20)
fig.update_yaxes(title_text='Average Returns', title_font_size=20)
fig.show()
